<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Trace Assistance</title>
<link href="css/trace.css" rel="stylesheet" >
<link href="css/bootstrap.css" rel="stylesheet" >
<link href="css/bootstrap-datetimepicker.css" rel="stylesheet" >
<script type="text/javascript" src="tService/js/js.php"></script>
<script type="text/javascript" src="js/js.php"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<script type="text/javascript" src="js/bootstrap-tooltip.js"></script>
<script type="text/javascript" src="js/bootstrap-datetimepicker.js"></script>
</head>
<body>
<span class="label">user: $user_id</span>
<div id="viewPanel" style="margin:5px">
<div class="btn-group">
<span class="label" style="vertical-align: middle">Zoom</span>
<input type="range" name="points" min="0" max="9" value="0" onchange="updateTextInput(this);">
<output id="rangevalue" class="label" style="vertical-align: middle">year</output>
</div>
<div class="input-append date " id="dp3" data-date="2013-10-16T05:25:07Z" data-date-format="dd MM yyyy - HH:ii p" style="margin: 0">
				<input class="span3" size="16" type="text" value="" readonly="" >
				<span class="add-on"><i class="icon-calendar"></i></span>
</div>
<div class="btn-group">
  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
    Action <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" role="menu">
    <li><a href="#" onclick="editStyle()")>Edit style</a></li>
  </ul>
</div>
</div>
<div class="container-fluid">
<div id="tracePanel" style="width: 1000px; border: solid 1px black" class="span8"></div>
<div id="controlPanel" class="span5" style=""></div>
<div id="userPanel" class="span5" style=""></div>
</div>



	<script type="text/javascript">
	
	function editStyle(){
		$.get("index.php?page=UserPreference&userid="+encodeURIComponent("$user_id"),function(data){			
			$("#userPanel").empty().append(data);
		});
	}
	
	function updateTextInput(obj) {
		
			var units = tAssistance.datetime.units;
			var unitTexts = tAssistance.datetime.unitTexts;
			var rangevalue = document.getElementById('rangevalue');
			
			iUnit = parseInt(obj.value);
			
			rangevalue.value = unitTexts[iUnit];		
				
			// create an event for update the trace
			var event = new CustomEvent(
					"changeSetting", 
					{
						detail: {
							unit: Math.round(units[iUnit]/1000),
							unitText: unitTexts[iUnit],
							time: new Date(),
						},
						bubbles: true,
						cancelable: true
					}
			);
			
			obj.dispatchEvent(event);
		}

		$(window).on("hashchange", function() {
			$('a[href="' + location.hash + '"]').tab('show');
		});

		//console.log("hoang");

		/*var a = new tService.Service({});
		a.createTrace({
			ktbs_base: "http://localhost:8001/ozalid/",
			name: "t2", 
			success: function(){console.log("success is callbacked");},
			error: function(jqXHR,textStatus, errorThrown){console.log("error is callbacked.");}
			});
		 */
		/*tService.trace_read({
						
			trace_uri: "http://localhost:8001/ozalid/t2/",			
			success: function(){console.log("success is callbacked");},
			error: function(jqXHR,textStatus, errorThrown){console.log("error is callbacked.");}
			});*/

		tAssistance.trace_view({
			trace_uri : "$trace_uri",
			success : function() {
				console.log("success is callbacked");
			},
			error : function(jqXHR, textStatus, errorThrown) {
				console.log("error is callbacked.");
			}

		});
			$('#dp3').datetimepicker({
		        //language:  'fr',
		        weekStart: 1,
		        todayBtn:  1,
				autoclose: 1,
				todayHighlight: 1,
				startView: 2,
				forceParse: 0,
		        showMeridian: 1
		    }).on('changeDate', function(ev){
		    	console.log(ev.date.valueOf());
		    	
		    	tAssistance.move(document.querySelector("g"), ev.date.valueOf());
		    });
			
		document.addEventListener("changeSetting", function(e){
			console.log(e.detail.unit);
			
			tAssistance.clear_obsels();
			obsels = tAssistance.getObsels("http://213.223.171.36/ktbs/ozalid_exp/","trc_u1", function(){
				var unit = e.detail.unit;
				var drawedObsels = tAssistance.draw_obsels3(obsels, document.querySelector("g"), e.detail.unit);
				if(e.detail.unitText=="year"||e.detail.unitText=="6 months"||e.detail.unitText=="3 months"){
					tAssistance.drawYears(drawedObsels);
					tAssistance.drawMonths1(drawedObsels);
				}
				else if(e.detail.unitText=="month"){
					tAssistance.drawMonths(drawedObsels);
					tAssistance.drawDates1(drawedObsels);
				}else if(e.detail.unitText=="week"){
					tAssistance.drawWeeks(drawedObsels);
					tAssistance.drawDates1(drawedObsels);
				}
				else if(e.detail.unitText=="day"||e.detail.unitText=="12 hours"){
					tAssistance.drawDates(drawedObsels);
					tAssistance.drawHours1(drawedObsels);					
				}
				else if(e.detail.unitText=="hour"||e.detail.unitText=="30 minutes"){
					tAssistance.drawHours(drawedObsels);			
					tAssistance.drawMinutes1(drawedObsels);
				}
				else if(e.detail.unitText=="minute"){
					tAssistance.drawMinutes(drawedObsels);	
					tAssistance.drawSeconds1(drawedObsels);
				}
			});
			
		}, false);
	</script>
</body>
</html>